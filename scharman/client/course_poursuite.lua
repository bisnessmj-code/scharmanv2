-- â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—
-- â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘
-- â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘
-- â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘
-- â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
-- â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•     â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•
-- CLIENT - MODE COURSE POURSUITE V2 (AMÃ‰LIORÃ‰)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- VARIABLES LOCALES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local inGame = false
local currentVehicle = nil
local instanceId = nil
local currentBucket = 0 -- âœ… Bucket actuel du joueur
local blockExitThread = nil
local zoneCheckThread = nil
local gameEndTime = nil
local gameStartTime = nil
local botPed = nil
local botVehicle = nil

-- âœ… ZONE DE GUERRE - Spawn immÃ©diat
local canExitVehicle = false
local warZoneActive = false
local warZonePosition = nil
local warZoneBlip = nil
local warZoneCenterBlip = nil
local warZoneThread = nil
local warZoneRadius = 50.0

-- âœ… DÃ‰COMPTE
local countdownActive = false

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- FONCTIONS UTILITAIRES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function ShowGameNotification(message, duration, notifType)
    SendNUIMessage({
        action = 'showNotification',
        data = {
            message = message,
            duration = duration or Config.CoursePoursuit.MessageDuration,
            type = notifType or 'info'
        }
    })
end

local function LoadModel(model)
    local modelHash = GetHashKey(model)
    
    if not IsModelValid(modelHash) then
        Config.ErrorPrint('ModÃ¨le invalide: ' .. model)
        return false
    end
    
    Config.DebugPrint('Demande de chargement du modÃ¨le: ' .. model)
    RequestModel(modelHash)
    
    local timeout = 0
    while not HasModelLoaded(modelHash) do
        Wait(100)
        timeout = timeout + 100
        
        if timeout >= 10000 then
            Config.ErrorPrint('Timeout lors du chargement du modÃ¨le: ' .. model)
            return false
        end
    end
    
    Config.SuccessPrint('ModÃ¨le chargÃ©: ' .. model)
    return true
end

local function ForcePlayerIntoVehicle(ped, vehicle, seat)
    Config.DebugPrint('Tentative de placement du joueur dans le vÃ©hicule...')
    
    if not DoesEntityExist(vehicle) then
        Config.ErrorPrint('Le vÃ©hicule n\'existe pas!')
        return false
    end
    
    if not DoesEntityExist(ped) then
        Config.ErrorPrint('Le PED n\'existe pas!')
        return false
    end
    
    SetVehicleOnGroundProperly(vehicle)
    Wait(100)
    
    Config.DebugPrint('Ã‰tat avant placement:')
    Config.DebugPrint('- VÃ©hicule existe: ' .. tostring(DoesEntityExist(vehicle)))
    Config.DebugPrint('- PED existe: ' .. tostring(DoesEntityExist(ped)))
    Config.DebugPrint('- SiÃ¨ge: ' .. tostring(seat))
    
    TaskWarpPedIntoVehicle(ped, vehicle, seat)
    Wait(500)
    
    local attempts = 0
    local maxAttempts = 10
    
    while GetVehiclePedIsIn(ped, false) ~= vehicle and attempts < maxAttempts do
        attempts = attempts + 1
        Config.DebugPrint('Tentative ' .. attempts .. '/' .. maxAttempts .. ' de placement...')
        
        TaskWarpPedIntoVehicle(ped, vehicle, seat)
        Wait(300)
        
        if GetVehiclePedIsIn(ped, false) ~= vehicle then
            Config.DebugPrint('TaskWarp Ã©chouÃ©, essai avec SetPedIntoVehicle...')
            SetPedIntoVehicle(ped, vehicle, seat)
            Wait(300)
        end
    end
    
    local currentVeh = GetVehiclePedIsIn(ped, false)
    local isInVehicle = currentVeh == vehicle
    
    Config.DebugPrint('Ã‰tat aprÃ¨s placement:')
    Config.DebugPrint('- VÃ©hicule actuel: ' .. tostring(currentVeh))
    Config.DebugPrint('- VÃ©hicule cible: ' .. tostring(vehicle))
    Config.DebugPrint('- Dans le vÃ©hicule: ' .. tostring(isInVehicle))
    Config.DebugPrint('- Tentatives: ' .. attempts)
    
    if isInVehicle then
        Config.SuccessPrint('Joueur placÃ© dans le vÃ©hicule avec succÃ¨s!')
        return true
    else
        Config.ErrorPrint('Ã‰CHEC: Le joueur n\'est pas dans le vÃ©hicule aprÃ¨s ' .. attempts .. ' tentatives')
        return false
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ZONE DE GUERRE
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- âœ… CORRECTION: DÃ©clarer StartWarZoneThread AVANT CreateWarZone
local function StartWarZoneThread()
    if warZoneThread then return end
    
    Config.InfoPrint('Thread de rendu zone de guerre dÃ©marrÃ©')
    
    warZoneThread = CreateThread(function()
        while inGame and warZoneActive do
            Wait(0)
            
            -- âœ… VÃ©rifier que warZonePosition existe avant de l'utiliser
            if not warZonePosition then
                Wait(100)
                goto continue
            end
            
            local pos = warZonePosition
            
            -- Colonne de lumiÃ¨re rouge (cylindre vertical)
            DrawMarker(
                28,
                pos.x, pos.y, pos.z,
                0.0, 0.0, 0.0,
                0.0, 0.0, 0.0,
                warZoneRadius, warZoneRadius, 150.0,
                255, 0, 0, 100,
                false, false, 2, false, nil, nil, false
            )
            
            -- Cercle au sol
            DrawMarker(
                1,
                pos.x, pos.y, pos.z - 1.0,
                0.0, 0.0, 0.0,
                0.0, 0.0, 0.0,
                warZoneRadius * 2, warZoneRadius * 2, 1.0,
                255, 0, 0, 150,
                false, false, 2, false, nil, nil, false
            )
            
            ::continue::
        end
        
        warZoneThread = nil
        Config.DebugPrint('Thread de rendu zone de guerre arrÃªtÃ©')
    end)
end

local function CreateWarZone(position)
    Config.InfoPrint('ğŸ”´ CRÃ‰ATION ZONE DE GUERRE')
    
    warZonePosition = position
    warZoneActive = true
    
    -- CrÃ©er le blip de rayon (zone rouge)
    if warZoneBlip then
        RemoveBlip(warZoneBlip)
    end
    
    warZoneBlip = AddBlipForRadius(position.x, position.y, position.z, warZoneRadius)
    SetBlipHighDetail(warZoneBlip, true)
    SetBlipColour(warZoneBlip, 1) -- Rouge
    SetBlipAlpha(warZoneBlip, 180)
    
    -- CrÃ©er le blip centre (crÃ¢ne)
    if warZoneCenterBlip then
        RemoveBlip(warZoneCenterBlip)
    end
    
    warZoneCenterBlip = AddBlipForCoord(position.x, position.y, position.z)
    SetBlipSprite(warZoneCenterBlip, 84) -- CrÃ¢ne
    SetBlipDisplay(warZoneCenterBlip, 4)
    SetBlipScale(warZoneCenterBlip, 1.2)
    SetBlipColour(warZoneCenterBlip, 1) -- Rouge
    SetBlipAsShortRange(warZoneCenterBlip, false)
    BeginTextCommandSetBlipName("STRING")
    AddTextComponentString("ğŸ”´ ZONE DE GUERRE")
    EndTextCommandSetBlipName(warZoneCenterBlip)
    
    Config.SuccessPrint('Zone de guerre crÃ©Ã©e Ã  la position: ' .. tostring(position))
    
    -- DÃ©marrer le thread de rendu
    StartWarZoneThread()
end

local function DeleteWarZone()
    Config.DebugPrint('Suppression de la zone de guerre...')
    
    warZoneActive = false
    warZonePosition = nil
    
    if warZoneBlip then
        RemoveBlip(warZoneBlip)
        warZoneBlip = nil
    end
    
    if warZoneCenterBlip then
        RemoveBlip(warZoneCenterBlip)
        warZoneCenterBlip = nil
    end
    
    if warZoneThread then
        warZoneThread = nil
    end
    
    Config.SuccessPrint('Zone de guerre supprimÃ©e')
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- DÃ‰COMPTE 3-2-1-GO
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function StartCountdown()
    Config.InfoPrint('â±ï¸ DÃ‰MARRAGE DU DÃ‰COMPTE')
    
    countdownActive = true
    
    -- Bloquer les contrÃ´les pendant le dÃ©compte
    local ped = PlayerPedId()
    FreezeEntityPosition(ped, true)
    
    -- 3
    SendNUIMessage({
        action = 'showCountdown',
        data = { number = 3 }
    })
    PlaySoundFrontend(-1, 'CHECKPOINT_NORMAL', 'HUD_MINI_GAME_SOUNDSET', true)
    Wait(1000)
    
    -- 2
    SendNUIMessage({
        action = 'showCountdown',
        data = { number = 2 }
    })
    PlaySoundFrontend(-1, 'CHECKPOINT_NORMAL', 'HUD_MINI_GAME_SOUNDSET', true)
    Wait(1000)
    
    -- 1
    SendNUIMessage({
        action = 'showCountdown',
        data = { number = 1 }
    })
    PlaySoundFrontend(-1, 'CHECKPOINT_NORMAL', 'HUD_MINI_GAME_SOUNDSET', true)
    Wait(1000)
    
    -- GO!
    SendNUIMessage({
        action = 'showCountdown',
        data = { number = 'GO!' }
    })
    PlaySoundFrontend(-1, 'RACE_PLACED', 'HUD_AWARDS', true)
    
    -- DÃ©bloquer
    FreezeEntityPosition(ped, false)
    
    Wait(1000)
    
    -- Cacher le dÃ©compte
    SendNUIMessage({
        action = 'hideCountdown'
    })
    
    countdownActive = false
    Config.SuccessPrint('âœ… DÃ©compte terminÃ© - C\'EST PARTI!')
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- FONCTIONS BOT
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function DeleteBot()
    Config.DebugPrint('Suppression du bot...')
    
    if DoesEntityExist(botVehicle) then
        DeleteEntity(botVehicle)
        botVehicle = nil
        Config.DebugPrint('VÃ©hicule bot supprimÃ©')
    end
    
    if DoesEntityExist(botPed) then
        DeleteEntity(botPed)
        botPed = nil
        Config.DebugPrint('Bot supprimÃ©')
    end
    
    Config.SuccessPrint('Bot nettoyÃ©')
end

local function SpawnBotAdversary()
    if not Config.CoursePoursuit.SpawnBotInSolo then
        Config.DebugPrint('Spawn bot dÃ©sactivÃ© dans la config')
        return false
    end
    
    Config.InfoPrint('â•â•â• DÃ‰BUT SPAWN BOT â•â•â•')
    
    local ped = PlayerPedId()
    local playerCoords = GetEntityCoords(ped)
    local playerHeading = GetEntityHeading(ped)
    
    local offset = Config.CoursePoursuit.BotSpawnOffset
    local forwardX = math.cos(math.rad(playerHeading))
    local forwardY = math.sin(math.rad(playerHeading))
    
    local botCoords = vector3(
        playerCoords.x + (forwardX * offset.x) + offset.y,
        playerCoords.y + (forwardY * offset.x),
        playerCoords.z + offset.z
    )
    
    if not LoadModel(Config.CoursePoursuit.BotModel) then
        Config.ErrorPrint('Ã‰chec chargement modÃ¨le bot')
        return false
    end
    
    Config.DebugPrint('CrÃ©ation du bot PED...')
    Config.DebugPrint('Position: ' .. tostring(botCoords))
    Config.DebugPrint('Bucket: ' .. tostring(currentBucket))
    
    botPed = CreatePed(4, GetHashKey(Config.CoursePoursuit.BotModel), botCoords.x, botCoords.y, botCoords.z, playerHeading, true, true)
    
    Config.DebugPrint('CreatePed retournÃ©: ' .. tostring(botPed))
    
    Wait(1000) -- âœ… AugmentÃ© Ã  1 seconde pour donner le temps au PED de spawn
    
    if not botPed or botPed == 0 or not DoesEntityExist(botPed) then
        Config.ErrorPrint('Ã‰chec crÃ©ation bot PED (Entity ID: ' .. tostring(botPed) .. ')')
        SetModelAsNoLongerNeeded(GetHashKey(Config.CoursePoursuit.BotModel))
        return false
    end
    
    Config.SuccessPrint('Bot PED entity crÃ©Ã© (ID: ' .. botPed .. ')')
    
    -- âœ… Mettre le bot dans le mÃªme routing bucket que le joueur
    if currentBucket > 0 then
        SetEntityRoutingBucket(botPed, currentBucket)
        Wait(200) -- Attendre que le bucket soit appliquÃ©
        Config.SuccessPrint('Bot PED placÃ© dans bucket ' .. currentBucket)
    else
        Config.ErrorPrint('Bucket invalide ou non dÃ©fini: ' .. tostring(currentBucket))
    end
    
    SetEntityInvincible(botPed, true)
    SetBlockingOfNonTemporaryEvents(botPed, true)
    Config.SuccessPrint('Bot PED crÃ©Ã©')
    
    if not LoadModel(Config.CoursePoursuit.BotVehicle) then
        Config.ErrorPrint('Ã‰chec chargement vÃ©hicule bot')
        DeleteEntity(botPed)
        botPed = nil
        return false
    end
    
    Config.DebugPrint('CrÃ©ation du vÃ©hicule bot...')
    
    botVehicle = CreateVehicle(
        GetHashKey(Config.CoursePoursuit.BotVehicle),
        botCoords.x, botCoords.y, botCoords.z,
        playerHeading, true, true
    )
    
    Config.DebugPrint('CreateVehicle retournÃ©: ' .. tostring(botVehicle))
    
    Wait(1000) -- âœ… AugmentÃ© Ã  1 seconde
    
    if not botVehicle or botVehicle == 0 or not DoesEntityExist(botVehicle) then
        Config.ErrorPrint('Ã‰chec crÃ©ation vÃ©hicule bot (Entity ID: ' .. tostring(botVehicle) .. ')')
        DeleteEntity(botPed)
        botPed = nil
        SetModelAsNoLongerNeeded(GetHashKey(Config.CoursePoursuit.BotVehicle))
        return false
    end
    
    Config.SuccessPrint('VÃ©hicule bot entity crÃ©Ã© (ID: ' .. botVehicle .. ')')
    
    -- âœ… Mettre le vÃ©hicule bot dans le mÃªme routing bucket
    if currentBucket > 0 then
        SetEntityRoutingBucket(botVehicle, currentBucket)
        Wait(200) -- Attendre que le bucket soit appliquÃ©
        Config.SuccessPrint('VÃ©hicule bot placÃ© dans bucket ' .. currentBucket)
    else
        Config.ErrorPrint('Bucket invalide pour vÃ©hicule bot: ' .. tostring(currentBucket))
    end
    
    Config.SuccessPrint('VÃ©hicule bot crÃ©Ã©')
    
    local botColor = Config.CoursePoursuit.BotVehicleColor
    SetVehicleCustomPrimaryColour(botVehicle, botColor.primary.r, botColor.primary.g, botColor.primary.b)
    SetVehicleCustomSecondaryColour(botVehicle, botColor.secondary.r, botColor.secondary.g, botColor.secondary.b)
    SetVehicleNumberPlateText(botVehicle, 'BOT~AI')
    SetVehicleEngineHealth(botVehicle, 1000.0)
    SetVehicleBodyHealth(botVehicle, 1000.0)
    SetVehicleOnGroundProperly(botVehicle)
    
    Wait(1000)
    
    TaskWarpPedIntoVehicle(botPed, botVehicle, -1)
    Wait(1000)
    
    local attempts = 0
    local maxAttempts = 5
    
    while GetVehiclePedIsIn(botPed, false) ~= botVehicle and attempts < maxAttempts do
        attempts = attempts + 1
        TaskWarpPedIntoVehicle(botPed, botVehicle, -1)
        Wait(500)
        
        if GetVehiclePedIsIn(botPed, false) ~= botVehicle then
            SetPedIntoVehicle(botPed, botVehicle, -1)
            Wait(500)
        end
    end
    
    if GetVehiclePedIsIn(botPed, false) ~= botVehicle then
        Config.ErrorPrint('Ã‰CHEC: Bot pas dans le vÃ©hicule!')
        DeleteBot()
        return false
    end
    
    if Config.CoursePoursuit.BotRandomRoute then
        TaskVehicleDriveWander(botPed, botVehicle, Config.CoursePoursuit.BotSpeed, Config.CoursePoursuit.BotDrivingStyle)
    else
        local targetCoords = vector3(botCoords.x + 500.0, botCoords.y + 500.0, botCoords.z)
        TaskVehicleDriveToCoordLongrange(botPed, botVehicle, targetCoords.x, targetCoords.y, targetCoords.z, Config.CoursePoursuit.BotSpeed, Config.CoursePoursuit.BotDrivingStyle, 10.0)
    end
    
    SetModelAsNoLongerNeeded(GetHashKey(Config.CoursePoursuit.BotModel))
    SetModelAsNoLongerNeeded(GetHashKey(Config.CoursePoursuit.BotVehicle))
    
    Config.InfoPrint('â•â•â• FIN SPAWN BOT - SUCCÃˆS â•â•â•')
    ShowGameNotification('ğŸ¤– Un adversaire bot est apparu !', 4000, 'success')
    
    return true
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- DÃ‰MARRAGE DU JEU
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function StartCoursePoursuiteGame(data)
    if inGame then
        Config.DebugPrint('DÃ©jÃ  en jeu')
        return
    end
    
    Config.InfoPrint('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
    Config.InfoPrint('DÃ‰MARRAGE DE LA COURSE POURSUITE V2')
    Config.InfoPrint('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
    
    local success, err = pcall(function()
        local ped = PlayerPedId()
        instanceId = data.instanceId
        
        local spawnCoords = data.spawnCoords or Config.CoursePoursuit.SpawnCoords
        local vehicleModel = data.vehicleModel or Config.CoursePoursuit.VehicleModel
        
        ShowGameNotification(Config.CoursePoursuit.Notifications.teleporting, 2000, 'info')
        
        DoScreenFadeOut(800)
        while not IsScreenFadedOut() do Wait(10) end
        
        SetEntityCoords(ped, spawnCoords.x, spawnCoords.y, spawnCoords.z, false, false, false, true)
        SetEntityHeading(ped, spawnCoords.w)
        
        local expectedBucket = data.bucketId
        currentBucket = expectedBucket or 0 -- âœ… Stocker le bucket
        if expectedBucket then
            Config.InfoPrint('Synchronisation routing bucket ' .. expectedBucket)
            Wait(3000)
            Config.SuccessPrint('DÃ©lai de synchronisation terminÃ©')
        else
            Wait(3000)
        end
        
        Wait(1000)
        
        -- âœ… RÃ©cupÃ©ration du vÃ©hicule crÃ©Ã© par le serveur
        local vehicleNetId = data.vehicleNetId
        
        if vehicleNetId then
            Config.InfoPrint('â•â•â• RÃ‰CUPÃ‰RATION VÃ‰HICULE SERVEUR â•â•â•')
            Config.DebugPrint('Vehicle Network ID reÃ§u: ' .. vehicleNetId)
            
            local maxAttempts = 100
            local attempt = 0
            
            repeat
                currentVehicle = NetworkGetEntityFromNetworkId(vehicleNetId)
                
                if currentVehicle and DoesEntityExist(currentVehicle) then
                    Config.SuccessPrint('VÃ©hicule rÃ©cupÃ©rÃ©: ' .. currentVehicle)
                    break
                end
                
                attempt = attempt + 1
                Wait(100)
                
                if attempt % 10 == 0 then
                    Config.DebugPrint('Attente vÃ©hicule... ' .. attempt .. '/100')
                end
            until attempt >= maxAttempts
            
            if not currentVehicle or not DoesEntityExist(currentVehicle) then
                error('Ã‰chec rÃ©cupÃ©ration vÃ©hicule - NetID: ' .. vehicleNetId)
            end
            
            SetVehicleOnGroundProperly(currentVehicle)
            Wait(500)
            
        else
            Config.ErrorPrint('Pas de Network ID reÃ§u - Fallback')
            
            if not LoadModel(vehicleModel) then
                error('Ã‰chec chargement modÃ¨le: ' .. vehicleModel)
            end
            
            currentVehicle = CreateVehicle(
                GetHashKey(vehicleModel),
                spawnCoords.x, spawnCoords.y, spawnCoords.z, spawnCoords.w,
                true, true
            )
            
            Wait(1500)
            
            if not DoesEntityExist(currentVehicle) then
                error('Ã‰chec crÃ©ation vÃ©hicule')
            end
            
            SetVehicleOnGroundProperly(currentVehicle)
            Wait(500)
        end
        
        -- Personnalisation
        if not vehicleNetId then
            local primaryColor = Config.CoursePoursuit.VehicleCustomization.primaryColor
            local secondaryColor = Config.CoursePoursuit.VehicleCustomization.secondaryColor
            SetVehicleCustomPrimaryColour(currentVehicle, primaryColor.r, primaryColor.g, primaryColor.b)
            SetVehicleCustomSecondaryColour(currentVehicle, secondaryColor.r, secondaryColor.g, secondaryColor.b)
            
            local mods = Config.CoursePoursuit.VehicleCustomization.mods
            SetVehicleMod(currentVehicle, 11, mods.engine, false)
            SetVehicleMod(currentVehicle, 12, mods.brakes, false)
            SetVehicleMod(currentVehicle, 13, mods.transmission, false)
            SetVehicleMod(currentVehicle, 15, mods.suspension, false)
            ToggleVehicleMod(currentVehicle, 18, mods.turbo)
            
            SetVehicleNumberPlateText(currentVehicle, 'COURSE')
            
            pcall(function()
                SetVehicleFuelLevel(currentVehicle, 100.0)
            end)
            
            SetVehicleEngineHealth(currentVehicle, 1000.0)
            SetVehicleBodyHealth(currentVehicle, 1000.0)
            SetVehicleDoorsLocked(currentVehicle, 2)
            SetVehicleDoorsLockedForAllPlayers(currentVehicle, true)
        else
            local primaryColor = Config.CoursePoursuit.VehicleCustomization.primaryColor
            local secondaryColor = Config.CoursePoursuit.VehicleCustomization.secondaryColor
            SetVehicleCustomPrimaryColour(currentVehicle, primaryColor.r, primaryColor.g, primaryColor.b)
            SetVehicleCustomSecondaryColour(currentVehicle, secondaryColor.r, secondaryColor.g, secondaryColor.b)
            
            local mods = Config.CoursePoursuit.VehicleCustomization.mods
            SetVehicleMod(currentVehicle, 11, mods.engine, false)
            SetVehicleMod(currentVehicle, 12, mods.brakes, false)
            SetVehicleMod(currentVehicle, 13, mods.transmission, false)
            SetVehicleMod(currentVehicle, 15, mods.suspension, false)
            ToggleVehicleMod(currentVehicle, 18, mods.turbo)
            
            SetVehicleNumberPlateText(currentVehicle, 'COURSE')
            
            pcall(function()
                SetVehicleFuelLevel(currentVehicle, 100.0)
            end)
            
            SetVehicleEngineHealth(currentVehicle, 1000.0)
            SetVehicleBodyHealth(currentVehicle, 1000.0)
            SetVehicleDoorsLocked(currentVehicle, 2)
            SetVehicleDoorsLockedForAllPlayers(currentVehicle, true)
            
            Config.SuccessPrint('VÃ©hicule personnalisÃ© cÃ´tÃ© client')
        end
        
        -- âœ… PLACEMENT JOUEUR
        Config.InfoPrint('â•â•â• PLACEMENT JOUEUR â•â•â•')
        local placementSuccess = ForcePlayerIntoVehicle(ped, currentVehicle, -1)
        
        if not placementSuccess then
            error('Impossible de placer le joueur dans le vÃ©hicule')
        end
        
        SetModelAsNoLongerNeeded(GetHashKey(vehicleModel))
        
        -- Fade in
        DoScreenFadeIn(500)
        while not IsScreenFadedIn() do Wait(10) end
        
        inGame = true
        gameStartTime = GetGameTimer()
        
        -- âœ… La zone sera crÃ©Ã©e quand le joueur SORT du vÃ©hicule
        Config.InfoPrint('Zone de guerre sera crÃ©Ã©e Ã  votre premiÃ¨re sortie')
        
        -- âœ… DÃ‰COMPTE 3-2-1-GO
        StartCountdown()
        
        -- Calculer fin de jeu
        if Config.CoursePoursuit.GameDuration > 0 then
            gameEndTime = GetGameTimer() + (Config.CoursePoursuit.GameDuration * 1000)
        end
        
        -- Spawner bot si solo
        if data.spawnBot then
            Config.InfoPrint('Mode solo - spawn bot dans 2s')
            Wait(2000)
            SpawnBotAdversary()
        end
        
        -- DÃ©marrer threads
        StartGameThreads()
        
        Config.SuccessPrint('COURSE POURSUITE V2 DÃ‰MARRÃ‰E!')
    end)
    
    if not success then
        Config.ErrorPrint('ERREUR: ' .. tostring(err))
        
        if IsScreenFadedOut() then
            DoScreenFadeIn(500)
        end
        
        if DoesEntityExist(currentVehicle) then
            DeleteEntity(currentVehicle)
            currentVehicle = nil
        end
        
        DeleteBot()
        DeleteWarZone()
        
        ShowGameNotification('âŒ Erreur: ' .. tostring(err), 5000, 'error')
        TriggerServerEvent('scharman:server:coursePoursuiteLeft', instanceId)
        
        inGame = false
        instanceId = nil
    end
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ARRÃŠT DU JEU
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function StopCoursePoursuiteGame()
    if not inGame then return end
    
    Config.InfoPrint('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
    Config.InfoPrint('ARRÃŠT DU MODE COURSE POURSUITE V2')
    Config.InfoPrint('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
    
    inGame = false
    blockExitThread = nil
    zoneCheckThread = nil
    vehicleExitThread = nil -- âœ… ArrÃªter le thread de dÃ©tection sortie
    damageZoneThread = nil -- âœ… ArrÃªter le thread de dÃ©gÃ¢ts
    gameEndTime = nil
    gameStartTime = nil
    countdownActive = false
    canExitVehicle = false
    zoneCreatedOnExit = false -- âœ… Reset flag
    currentBucket = 0 -- âœ… Reset bucket
    
    -- âœ… Masquer l'Ã©cran de mort si affichÃ©
    SendNUIMessage({
        action = 'hideDeathScreen'
    })
    
    -- âœ… SUPPRIMER LA ZONE DE GUERRE
    DeleteWarZone()
    
    local ped = PlayerPedId()
    
    -- TÃ©lÃ©portation retour
    if Config.CoursePoursuit.ReturnToNormalCoords then
        DoScreenFadeOut(500)
        Wait(500)
        
        local returnCoords = Config.CoursePoursuit.ReturnToNormalCoords
        SetEntityCoords(ped, returnCoords.x, returnCoords.y, returnCoords.z, false, false, false, true)
        SetEntityHeading(ped, returnCoords.w)
        
        Wait(500)
        DoScreenFadeIn(500)
    end
    
    -- âœ… SUPPRIMER LE VÃ‰HICULE
    if DoesEntityExist(currentVehicle) then
        DeleteEntity(currentVehicle)
        currentVehicle = nil
        Config.DebugPrint('VÃ©hicule joueur supprimÃ©')
    end
    
    -- âœ… SUPPRIMER LE BOT
    DeleteBot()
    
    instanceId = nil
    
    Config.SuccessPrint('NETTOYAGE TERMINÃ‰')
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- THREADS DE GESTION
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function StartBlockExitThread()
    if blockExitThread then return end
    
    Config.DebugPrint('Thread blocage sortie dÃ©marrÃ©')
    
    -- Timer 30 secondes
    CreateThread(function()
        -- Afficher le message de blocage
        SendNUIMessage({
            action = 'showVehicleLock',
            data = { duration = 30000 }
        })
        
        Wait(30000)
        
        canExitVehicle = true
        
        -- Masquer le message
        SendNUIMessage({
            action = 'hideVehicleLock'
        })
        
        Config.SuccessPrint('âœ… Vous pouvez maintenant sortir du vÃ©hicule!')
        ShowGameNotification('âœ… Vous pouvez maintenant sortir du vÃ©hicule!', 5000, 'success')
    end)
    
    blockExitThread = CreateThread(function()
        local wasInVehicle = true
        
        while inGame and Config.CoursePoursuit.BlockExitVehicle do
            Wait(0)
            
            local ped = PlayerPedId()
            local isInVehicle = IsPedInVehicle(ped, currentVehicle, false)
            
            if not canExitVehicle then
                DisableControlAction(0, 75, true)
                
                if IsDisabledControlJustPressed(0, 75) then
                    local timeElapsed = (GetGameTimer() - gameStartTime) / 1000
                    local timeLeft = math.max(0, 30 - timeElapsed)
                    ShowGameNotification(string.format('â° Attendez encore %d secondes!', math.ceil(timeLeft)), 3000, 'warning')
                end
                
                if DoesEntityExist(currentVehicle) and not isInVehicle then
                    ForcePlayerIntoVehicle(ped, currentVehicle, -1)
                    ShowGameNotification('ğŸš— Retour forcÃ© - Attendez 30s', 3000, 'warning')
                end
            end
            
            wasInVehicle = isInVehicle
        end
        
        blockExitThread = nil
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- THREAD DÃ‰GÃ‚TS ZONE DE GUERRE
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local damageZoneThread = nil

local function StartDamageZoneThread()
    if damageZoneThread then return end
    
    Config.InfoPrint('Thread dÃ©gÃ¢ts zone de guerre dÃ©marrÃ©')
    
    damageZoneThread = CreateThread(function()
        while inGame and warZoneActive do
            Wait(2000) -- VÃ©rifier toutes les 2 secondes
            
            -- Attendre que la zone soit crÃ©Ã©e
            if not warZonePosition or not zoneCreatedOnExit then
                goto continue
            end
            
            local ped = PlayerPedId()
            
            -- VÃ©rifier si le joueur est mort
            if IsEntityDead(ped) or GetEntityHealth(ped) <= 0 then
                Config.InfoPrint('ğŸ’€ JOUEUR MORT DÃ‰TECTÃ‰')
                
                -- Afficher Ã©cran de mort
                SendNUIMessage({
                    action = 'showDeathScreen'
                })
                
                Wait(3000) -- Attendre 3 secondes
                
                -- Terminer la partie
                StopCoursePoursuiteGame()
                TriggerServerEvent('scharman:server:coursePoursuiteLeft', instanceId)
                ShowGameNotification('ğŸ’€ Vous Ãªtes mort !', 3000, 'error')
                
                break
            end
            
            local playerCoords = GetEntityCoords(ped)
            local distance = #(playerCoords - warZonePosition)
            
            -- Si hors de la zone de guerre
            if distance > warZoneRadius then
                local currentHealth = GetEntityHealth(ped)
                local newHealth = currentHealth - 20
                
                Config.DebugPrint('âš¡ DÃ‰GÃ‚TS ZONE: -20 HP (Health: ' .. currentHealth .. ' â†’ ' .. newHealth .. ')')
                
                -- Infliger dÃ©gÃ¢ts
                SetEntityHealth(ped, math.max(0, newHealth))
                
                -- Effet visuel
                SetPedToRagdoll(ped, 500, 500, 0, 0, 0, 0)
                
                -- Notification
                ShowGameNotification('âš¡ DÃ‰GÃ‚TS ZONE: -20 HP', 1500, 'error')
                
                -- VÃ©rifier si mort aprÃ¨s dÃ©gÃ¢ts
                if newHealth <= 0 then
                    Config.InfoPrint('ğŸ’€ JOUEUR TUÃ‰ PAR LA ZONE')
                    -- Le thread dÃ©tectera la mort au prochain cycle
                end
            end
            
            ::continue::
        end
        
        damageZoneThread = nil
        Config.DebugPrint('Thread dÃ©gÃ¢ts zone de guerre arrÃªtÃ©')
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- THREAD VÃ‰RIFICATION ZONE (TÃ©lÃ©portation)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local function StartZoneCheckThread()
    if not Config.CoursePoursuit.UseZoneLimit then return end
    if zoneCheckThread then return end
    
    Config.DebugPrint('Thread vÃ©rification zone dÃ©marrÃ©')
    
    zoneCheckThread = CreateThread(function()
        local timeOutOfZone = 0
        
        while inGame do
            Wait(1000)
            
            local ped = PlayerPedId()
            local playerCoords = GetEntityCoords(ped)
            local zoneCenter = Config.CoursePoursuit.SpawnCoords
            local distance = #(playerCoords - vector3(zoneCenter.x, zoneCenter.y, zoneCenter.z))
            
            if distance > Config.CoursePoursuit.ZoneRadius then
                timeOutOfZone = timeOutOfZone + 1
                
                if timeOutOfZone == 1 then
                    ShowGameNotification('âš ï¸ Retournez dans la zone!', 3000, 'warning')
                end
                
                if timeOutOfZone >= Config.CoursePoursuit.OutOfZoneTimeout then
                    ShowGameNotification('ğŸš« Trop loin - TÃ©lÃ©portation...', 3000, 'error')
                    SetEntityCoords(ped, zoneCenter.x, zoneCenter.y, zoneCenter.z, false, false, false, true)
                    timeOutOfZone = 0
                end
            else
                timeOutOfZone = 0
            end
        end
        
        zoneCheckThread = nil
    end)
end

local function StartGameTimerThread()
    if Config.CoursePoursuit.GameDuration <= 0 then return end
    
    CreateThread(function()
        while inGame and gameEndTime do
            Wait(1000)
            
            if not gameEndTime then break end
            
            local timeLeft = gameEndTime - GetGameTimer()
            
            if timeLeft <= 0 then
                ShowGameNotification('â±ï¸ Temps Ã©coulÃ©!', 5000, 'info')
                StopCoursePoursuiteGame()
                TriggerServerEvent('scharman:server:coursePoursuiteLeft', instanceId)
                break
            end
        end
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- DÃ‰TECTION SORTIE VÃ‰HICULE (Pour crÃ©er la zone)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

local vehicleExitThread = nil
local zoneCreatedOnExit = false

local function StartVehicleExitDetectionThread()
    if vehicleExitThread then return end
    
    zoneCreatedOnExit = false
    
    vehicleExitThread = CreateThread(function()
        Config.DebugPrint('Thread dÃ©tection sortie vÃ©hicule dÃ©marrÃ©')
        
        while inGame and not zoneCreatedOnExit do
            Wait(500) -- Check toutes les 500ms
            
            local ped = PlayerPedId()
            
            -- Si le joueur peut sortir ET n'est PAS dans un vÃ©hicule
            if canExitVehicle and not IsPedInAnyVehicle(ped, false) then
                -- CrÃ©er la zone de guerre Ã  la position actuelle
                local coords = GetEntityCoords(ped)
                CreateWarZone(coords)
                ShowGameNotification('ğŸ”´ ZONE DE GUERRE crÃ©Ã©e Ã  votre position !', 5000, 'warning')
                
                -- âœ… DONNER L'ARME CAL50
                local weaponHash = GetHashKey('WEAPON_PISTOL50')
                GiveWeaponToPed(ped, weaponHash, 250, false, true)
                SetCurrentPedWeapon(ped, weaponHash, true)
                Config.SuccessPrint('Arme donnÃ©e: Pistolet Cal .50')
                ShowGameNotification('ğŸ”« Pistolet Cal .50 Ã©quipÃ© !', 3000, 'success')
                
                zoneCreatedOnExit = true
                Config.SuccessPrint('Zone de guerre crÃ©Ã©e Ã  la sortie du vÃ©hicule')
                break
            end
        end
        
        vehicleExitThread = nil
        Config.DebugPrint('Thread dÃ©tection sortie vÃ©hicule arrÃªtÃ©')
    end)
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- DÃ‰MARRAGE DES THREADS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function StartGameThreads()
    StartBlockExitThread()
    StartZoneCheckThread()
    StartGameTimerThread()
    StartVehicleExitDetectionThread()
    StartDamageZoneThread() -- âœ… Nouveau thread pour dÃ©gÃ¢ts
end

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- Ã‰VÃ‰NEMENTS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RegisterNetEvent('scharman:client:startCoursePoursuit', function(data)
    StartCoursePoursuiteGame(data)
end)

RegisterNetEvent('scharman:client:stopCoursePoursuit', function()
    StopCoursePoursuiteGame()
end)

RegisterNetEvent('scharman:client:courseNotification', function(message, duration, notifType)
    ShowGameNotification(message, duration or 3000, notifType or 'info')
end)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- COMMANDES
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RegisterCommand('quit_course', function()
    if inGame then
        StopCoursePoursuiteGame()
        TriggerServerEvent('scharman:server:coursePoursuiteLeft', instanceId)
        ShowGameNotification('âœ… Vous avez quittÃ©', 3000, 'success')
    else
        ShowGameNotification('âŒ Vous n\'Ãªtes pas en partie', 3000, 'error')
    end
end, false)

if Config.Debug then
    RegisterCommand('course_stop', function()
        if inGame then
            StopCoursePoursuiteGame()
            TriggerServerEvent('scharman:server:coursePoursuiteLeft', instanceId)
        end
    end, false)
    
    RegisterCommand('course_info', function()
        print('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
        print('Ã‰tat: ' .. (inGame and 'EN JEU' or 'PAS EN JEU'))
        print('Instance: ' .. (instanceId or 'Aucune'))
        print('VÃ©hicule: ' .. (currentVehicle or 'Aucun'))
        print('Zone de guerre: ' .. (warZoneActive and 'ACTIVE' or 'INACTIVE'))
        print('Peut sortir vÃ©hicule: ' .. (canExitVehicle and 'OUI' or 'NON'))
        print('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•')
    end, false)
end

Config.DebugPrint('client/course_poursuite.lua V2 chargÃ©')
